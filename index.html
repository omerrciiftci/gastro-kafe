<!doctype html>
<html lang="tr" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="author" content="Ã–mer Faruk Ã‡iftci">
  <meta name="description" content="Gastro Ä°negÃ¶l Dijital MenÃ¼ - Developed by Ã–mer Faruk Ã‡iftci">
  
  <title>Gastro Ä°negÃ¶l</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config={darkMode:'class',theme:{extend:{colors:{brand:'var(--brand-color)'}}}}</script>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    :root { --brand-color: #ea580c; }
    body { font-family: 'Outfit', sans-serif; transition: background-color 0.3s, color 0.3s; }
    
    /* Intro AnimasyonlarÄ± */
    #intro-screen { transition: transform 0.8s cubic-bezier(0.77, 0, 0.175, 1); }
    .slide-up { transform: translateY(-100%); }
    
    .glass-card { background: rgba(255,255,255,0.1); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
    .dark .glass-card { background: rgba(30,41,59,0.7); border: 1px solid rgba(255,255,255,0.05); }
    .hide-scroll::-webkit-scrollbar { display: none; }
    .cat-btn.active { background: var(--brand-color); color: white; border:none; }
    #sidebar { transition: transform 0.3s ease-in-out; transform: translateX(100%); }
    #sidebar.open { transform: translateX(0); }
    .credit-card { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); }
    
    /* MÃ¼zik Ekolayzer */
    .music-bar { width: 4px; background: #22c55e; animation: equalizer 1s infinite ease-in-out; }
    .music-bar:nth-child(2) { animation-delay: 0.2s; height: 60%; }
    .music-bar:nth-child(3) { animation-delay: 0.4s; height: 80%; }
    @keyframes equalizer { 0%, 100% { height: 20%; } 50% { height: 100%; } }
  </style>
</head>
<body class="bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-100 pb-32 overflow-hidden">

  <audio id="alarm-sound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" preload="auto"></audio>

  <div id="intro-screen" class="fixed inset-0 z-[999] bg-gray-900 flex flex-col items-center justify-center text-white">
      <div class="relative mb-8">
          <div class="absolute inset-0 bg-orange-500 blur-3xl opacity-20 animate-pulse"></div>
          <div class="text-6xl mb-4 relative z-10 animate-bounce">ğŸ²</div>
      </div>
      <h1 class="text-4xl font-bold mb-2 tracking-tight">Gastro <span class="text-orange-500">Ä°negÃ¶l</span></h1>
      <p class="text-gray-400 mb-10 text-sm tracking-widest uppercase">Yeni Nesil Lezzet Deneyimi</p>
      
      <button onclick="enterSite()" class="group relative px-8 py-4 bg-orange-600 rounded-full font-bold text-lg overflow-hidden shadow-2xl hover:scale-105 transition duration-300">
          <span class="relative z-10">MENÃœYE BAÅLA ğŸš€</span>
          <div class="absolute inset-0 h-full w-full scale-0 rounded-full transition-all duration-300 group-hover:scale-150 group-hover:bg-orange-500/50"></div>
      </button>
      
      <div class="absolute bottom-8 text-xs text-gray-600 uppercase tracking-wider">
          Dev by Ã–mer Faruk Ã‡iftci
      </div>
  </div>

  <div class="sticky top-0 z-40 bg-white/95 dark:bg-gray-900/95 backdrop-blur-md border-b border-gray-200 dark:border-gray-800 shadow-sm">
    <div class="p-4 flex justify-between items-center">
        <div>
            <h2 class="font-bold text-xl text-brand">Gastro Ä°negÃ¶l</h2>
            <div class="flex items-center gap-2 text-xs text-gray-500">
                <span id="live-time" class="font-mono font-bold">00:00</span>
                <span id="live-date" class="hidden sm:inline">...</span>
            </div>
        </div>
        
        <button onclick="toggleSidebar()" class="p-2 rounded-lg bg-gray-200 dark:bg-gray-800">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
        </button>
    </div>

    <div class="px-4 pb-2">
        <div class="relative">
            <input type="text" id="search-box" oninput="searchProduct(this.value)" placeholder="ÃœrÃ¼n ara... (Ã¶rn: Su, KÃ¶fte)" class="w-full bg-gray-100 dark:bg-gray-800 border-none rounded-xl py-3 pl-10 pr-4 outline-none focus:ring-2 focus:ring-[var(--brand-color)] transition shadow-inner">
            <span class="absolute left-3 top-3.5 text-gray-400">ğŸ”</span>
        </div>
    </div>

    <div class="flex overflow-x-auto gap-3 p-4 pt-2 hide-scroll" id="category-nav"></div>
  </div>

  <div id="sidebar" class="fixed inset-y-0 right-0 w-72 bg-white dark:bg-gray-800 shadow-2xl z-[100] p-6">
    <div class="flex justify-between items-center mb-8">
        <h3 class="font-bold text-xl" data-lang="settings">Ayarlar</h3>
        <button onclick="toggleSidebar()" class="text-2xl">&times;</button>
    </div>
    
    <div class="space-y-6">
        <button onclick="openMusicModal(); toggleSidebar();" class="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white p-4 rounded-xl font-bold shadow-lg flex items-center gap-3 hover:scale-105 transition">
            <div class="bg-white/20 p-2 rounded-lg text-xl">ğŸµ</div>
            <div class="text-left">
                <div class="text-xs opacity-80">Gastro Radyo</div>
                <div class="text-sm">MÃ¼zik OylamasÄ±na KatÄ±l</div>
            </div>
        </button>

        <hr class="border-gray-200 dark:border-gray-700">

        <div>
            <h4 class="text-sm font-bold text-gray-500 mb-2">Language / Dil</h4>
            <div class="flex gap-2">
                <button onclick="changeLang('tr')" class="flex-1 py-2 rounded-lg border border-gray-300 dark:border-gray-600 font-bold hover:bg-gray-100 dark:hover:bg-gray-700">ğŸ‡¹ğŸ‡· TR</button>
                <button onclick="changeLang('en')" class="flex-1 py-2 rounded-lg border border-gray-300 dark:border-gray-600 font-bold hover:bg-gray-100 dark:hover:bg-gray-700">ğŸ‡¬ğŸ‡§ EN</button>
            </div>
        </div>

        <div>
            <h4 class="text-sm font-bold text-gray-500 mb-2" data-lang="theme">Tema</h4>
            <div class="flex gap-2 p-1 bg-gray-200 dark:bg-gray-700 rounded-xl">
                <button onclick="setTheme('light')" class="flex-1 py-2 rounded-lg text-sm font-bold bg-white dark:bg-transparent shadow-sm dark:shadow-none">â˜€ï¸</button>
                <button onclick="setTheme('dark')" class="flex-1 py-2 rounded-lg text-sm font-bold dark:bg-gray-600">ğŸŒ™</button>
            </div>
        </div>
        
        <div>
            <h4 class="text-sm font-bold text-gray-500 mb-2" data-lang="color">Renk</h4>
            <div class="grid grid-cols-4 gap-2">
                <button onclick="setColor('#ea580c')" class="w-10 h-10 rounded-full bg-orange-600"></button>
                <button onclick="setColor('#2563eb')" class="w-10 h-10 rounded-full bg-blue-600"></button>
                <button onclick="setColor('#7c3aed')" class="w-10 h-10 rounded-full bg-purple-600"></button>
                <button onclick="setColor('#16a34a')" class="w-10 h-10 rounded-full bg-green-600"></button>
            </div>
        </div>
    </div>
  </div>

  <div class="container mx-auto px-4 mt-6 min-h-[60vh]" id="menu-container"></div>

  <div class="text-center text-xs text-gray-400 dark:text-gray-600 py-8 mb-24 font-semibold tracking-wider uppercase select-none">
      Designed & Developed by <span class="text-[var(--brand-color)]">Ã–mer Faruk Ã‡iftci</span>
  </div>

  <div id="product-modal" class="fixed inset-0 bg-black/90 z-[150] hidden flex items-center justify-center p-4 backdrop-blur-md" onclick="closeProductModal()">
      <div class="bg-gray-900 w-full max-w-sm rounded-3xl p-6 relative border border-gray-700 shadow-2xl animate-[slideUp_0.3s]" onclick="event.stopPropagation()">
          <button onclick="closeProductModal()" class="absolute top-4 right-4 text-white text-2xl z-10 bg-black/50 w-8 h-8 flex items-center justify-center rounded-full hover:bg-red-600 transition">&times;</button>
          
          <div class="text-8xl text-center mb-6 animate-bounce mt-4 drop-shadow-2xl" id="modal-img">ğŸ”</div>
          
          <h2 class="text-3xl font-bold text-white mb-2 text-center" id="modal-title">ÃœrÃ¼n AdÄ±</h2>
          <p class="text-gray-400 text-center mb-6 px-4 leading-relaxed" id="modal-desc">ÃœrÃ¼n aÃ§Ä±klamasÄ± burada yer alacak.</p>
          
          <div class="text-5xl font-bold text-[var(--brand-color)] text-center mb-8 drop-shadow-lg" id="modal-price">0 â‚º</div>
          
          <button id="modal-add-btn" class="w-full bg-[var(--brand-color)] text-white py-4 rounded-2xl font-bold text-xl shadow-lg active:scale-95 transition flex justify-center items-center gap-2">
              <span>Sepete Ekle</span> ğŸ›’
          </button>
      </div>
  </div>

  <div id="music-modal" class="fixed inset-0 bg-black/80 z-[90] hidden flex items-center justify-center p-4 backdrop-blur-md">
    <div class="bg-gray-900 w-full max-w-md rounded-3xl p-6 border border-white/10 relative shadow-2xl animate-[slideUp_0.3s]">
        <button onclick="closeMusicModal()" class="absolute top-4 right-4 text-gray-400 text-2xl hover:text-white">&times;</button>
        
        <div class="text-center mb-8 mt-2">
            <div class="text-xs text-[var(--brand-color)] font-bold tracking-widest mb-2">ÅU AN Ã‡ALIYOR</div>
            <div class="flex justify-center items-end gap-1 h-12 mb-4">
                <div class="music-bar"></div><div class="music-bar"></div><div class="music-bar"></div><div class="music-bar"></div><div class="music-bar"></div>
            </div>
            <h3 id="current-song-title" class="text-2xl font-bold text-white">YÃ¼kleniyor...</h3>
            <p id="current-song-artist" class="text-gray-400">...</p>
        </div>

        <div class="space-y-4">
            <div class="text-sm text-gray-500 font-bold mb-2 uppercase">SÄ±radaki ÅarkÄ±yÄ± SeÃ§ (% Oy)</div>
            <div id="music-list" class="space-y-3 max-h-60 overflow-y-auto hide-scroll"></div>
        </div>
    </div>
  </div>

  <div id="cart-bar" class="fixed bottom-4 left-4 right-4 glass-card p-4 rounded-2xl shadow-xl transform translate-y-[150%] transition-transform duration-300 z-50 flex justify-between items-center bg-white dark:bg-gray-800">
    <div class="flex flex-col">
        <span class="text-xs text-gray-500 dark:text-gray-400" data-lang="total">Toplam</span>
        <span class="text-2xl font-bold dark:text-white" id="total-price">0 â‚º</span>
    </div>
    <button onclick="openPaymentModal()" class="bg-[var(--brand-color)] text-white px-6 py-3 rounded-xl font-bold flex items-center gap-2 shadow-lg active:scale-95 transition">
        <span data-lang="confirm_cart">Sepeti Onayla</span>
        <span id="cart-badge" class="bg-white text-[var(--brand-color)] text-xs px-2 py-0.5 rounded-full font-extrabold hidden">0</span>
    </button>
  </div>

  <div id="payment-modal" class="fixed inset-0 bg-black/60 z-[60] hidden flex items-end sm:items-center justify-center p-4 backdrop-blur-sm">
    <div class="bg-white dark:bg-gray-800 w-full max-w-md rounded-t-3xl sm:rounded-3xl p-6 shadow-2xl animate-[slideUp_0.3s]">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold dark:text-white" data-lang="payment_title">Ã–deme Bilgileri</h2>
            <button onclick="closePaymentModal()" class="text-gray-400 text-2xl">&times;</button>
        </div>
        
        <div class="credit-card text-white p-6 rounded-2xl mb-6 shadow-lg relative overflow-hidden">
            <div class="absolute top-0 right-0 -m-4 w-24 h-24 bg-white/10 rounded-full blur-xl"></div>
            <div class="flex justify-between items-center mb-8">
                <span class="text-xs opacity-70">Credit Card</span>
                <span class="font-bold italic">VISA</span>
            </div>
            <div class="text-2xl font-mono mb-4 tracking-widest">**** **** **** 1453</div>
            <div class="flex justify-between">
                <div>
                    <div class="text-[10px] opacity-70">Holder</div>
                    <div class="text-sm font-bold">MÃœÅTERÄ°</div>
                </div>
                <div>
                    <div class="text-[10px] opacity-70">Exp</div>
                    <div class="text-sm font-bold">12/28</div>
                </div>
            </div>
        </div>

        <div class="space-y-4">
            <input type="text" id="customer-name" class="w-full bg-gray-100 dark:bg-gray-700 dark:text-white rounded-xl p-4 outline-none border-2 border-transparent focus:border-[var(--brand-color)]" placeholder="AdÄ±nÄ±z SoyadÄ±nÄ±z / Name">
            <select id="table-no" class="w-full bg-gray-100 dark:bg-gray-700 dark:text-white rounded-xl p-4 outline-none">
                <option value="Masa 1">Masa / Table 1</option>
                <option value="Masa 2">Masa / Table 2</option>
                <option value="Masa 3">Masa / Table 3</option>
                <option value="BahÃ§e 1">BahÃ§e / Garden 1</option>
                <option value="BahÃ§e 2">BahÃ§e / Garden 2</option>
            </select>
            <button onclick="processOrder()" class="w-full bg-green-600 text-white py-4 rounded-xl font-bold text-lg shadow-lg flex justify-center items-center gap-2 hover:bg-green-500 transition">
                <span data-lang="pay_btn">Ã–deme Yap ve SipariÅŸ Ver</span> ğŸ”’
            </button>
        </div>
    </div>
  </div>

  <div id="preparing-view" class="fixed inset-0 bg-yellow-500 z-[70] hidden flex flex-col items-center justify-center p-8 text-center text-white">
    <div class="w-24 h-24 border-8 border-white border-t-transparent rounded-full animate-spin mb-6"></div>
    <h2 class="text-3xl font-bold mb-2" data-lang="prep_title">HazÄ±rlanÄ±yor...</h2>
    <p class="text-yellow-100 text-lg" data-lang="prep_desc">SipariÅŸiniz mutfaÄŸa iletildi.</p>
  </div>

  <div id="ready-view" class="fixed inset-0 bg-green-600 z-[80] hidden flex flex-col items-center justify-center p-8 text-center text-white">
    <div class="text-6xl mb-6 animate-bounce">ğŸ””</div>
    <h2 class="text-4xl font-bold mb-4" data-lang="ready_title">SÄ°PARÄ°Å HAZIR!</h2>
    <p class="text-green-100 text-lg mb-8" data-lang="ready_desc">LÃ¼tfen mutfak bankosundan teslim alÄ±nÄ±z.</p>
    <button id="btn-received" onclick="confirmReceived()" class="bg-white text-green-700 px-10 py-5 rounded-2xl font-bold text-xl shadow-2xl hover:scale-105 transition">
        <span data-lang="btn_received">âœ… Teslim AldÄ±m</span>
    </button>
    <div id="waiting-waiter-msg" class="hidden mt-4 bg-green-800/50 p-4 rounded-xl animate-pulse">
        <span data-lang="wait_waiter">â³ Garson onayÄ± bekleniyor...</span>
    </div>
  </div>

  <script>
    // --- GÄ°RÄ°Å ANÄ°MASYONU ---
    function enterSite() {
        document.getElementById('intro-screen').classList.add('slide-up');
        document.body.classList.remove('overflow-hidden');
        requestNotificationPermission();
    }

    // --- SAAT FONKSÄ°YONU ---
    function updateClock() {
        const now = new Date();
        const timeStr = now.toLocaleTimeString('tr-TR', {hour:'2-digit', minute:'2-digit', second:'2-digit'});
        const dateStr = now.toLocaleDateString('tr-TR', {weekday:'long', day:'numeric', month:'long'});
        
        const timeEl = document.getElementById('live-time');
        const dateEl = document.getElementById('live-date');
        
        if(timeEl) timeEl.innerText = timeStr;
        if(dateEl) dateEl.innerText = dateStr;
    }
    setInterval(updateClock, 1000);
    updateClock();

    // --- ALARM SÄ°STEMÄ° ---
    function playAlarm() {
        const audio = document.getElementById('alarm-sound');
        if(audio) {
            audio.currentTime = 0;
            audio.play().catch(e => console.log("Otomatik oynatma kÄ±sÄ±tlamasÄ± olabilir."));
        }
        if(navigator.vibrate) navigator.vibrate([500, 200, 500, 200, 1000]); // GÃ¼Ã§lÃ¼ titreÅŸim
    }

    // --- BÄ°LDÄ°RÄ°M Ä°ZNÄ° ---
    function requestNotificationPermission() {
        if ("Notification" in window) {
            Notification.requestPermission();
        }
    }

    // --- ARAMA SÄ°STEMÄ° (SU YAZINCA DÄ°REKT GELMESÄ°) ---
    function searchProduct(query) {
        query = query.toLowerCase();
        
        categories.forEach(cat => {
            const catDiv = document.getElementById(cat.id);
            const itemsInCat = menuItems.filter(i => i.cat === cat.id);
            let hasMatch = false;

            // Kategori iÃ§indeki Ã¼rÃ¼nleri bul
            const itemDivs = catDiv.querySelectorAll('.glass-card');
            
            itemsInCat.forEach((item, index) => {
                // Sadece element varsa iÅŸlem yap (Hata Ã¶nleyici)
                if(itemDivs[index]) {
                    const iName = (currentLang==='tr'?item.name_tr:item.name_en).toLowerCase();
                    if (iName.includes(query)) {
                        itemDivs[index].style.display = "flex"; // GÃ¶ster
                        hasMatch = true;
                    } else {
                        itemDivs[index].style.display = "none"; // Gizle
                    }
                }
            });

            // EÄŸer kategoride hiÃ§ eÅŸleÅŸme yoksa baÅŸlÄ±ÄŸÄ± da gizle
            catDiv.style.display = hasMatch ? "block" : "none";
        });
    }

    // --- ÃœRÃœN DETAY MODALI ---
    function openProductDetail(id) {
        const item = menuItems.find(i => i.id === id);
        if(!item) return;

        const name = currentLang === 'tr' ? item.name_tr : item.name_en;
        const desc = currentLang === 'tr' ? item.desc_tr : item.desc_en;

        document.getElementById('modal-img').innerText = item.img;
        document.getElementById('modal-title').innerText = name;
        document.getElementById('modal-desc').innerText = desc;
        document.getElementById('modal-price').innerText = item.price + " â‚º";
        
        const btn = document.getElementById('modal-add-btn');
        btn.onclick = function() { add(id); closeProductModal(); };

        document.getElementById('product-modal').classList.remove('hidden');
    }
    function closeProductModal() { document.getElementById('product-modal').classList.add('hidden'); }

    // --- MÃœZÄ°K SÄ°STEMÄ° ---
    window.openMusicModal = () => { document.getElementById('music-modal').classList.remove('hidden'); loadMusicData(); }
    window.closeMusicModal = () => document.getElementById('music-modal').classList.add('hidden');

    async function loadMusicData() {
        try {
            const res = await fetch('/api/music');
            const data = await res.json();
            
            document.getElementById('current-song-title').innerText = data.now_playing.title;
            document.getElementById('current-song-artist').innerText = data.now_playing.artist;

            const listHtml = data.candidates.map(song => `
                <div class="bg-gray-800 p-3 rounded-xl border border-gray-700 cursor-pointer hover:border-[var(--brand-color)] transition group" onclick="voteSong(${song.id})">
                    <div class="flex justify-between text-white text-sm font-bold mb-2">
                        <span class="group-hover:text-[var(--brand-color)] transition">${song.title} - ${song.artist}</span>
                        <span class="bg-gray-700 px-2 rounded text-xs flex items-center">%${song.percent}</span>
                    </div>
                    <div class="w-full bg-gray-700 rounded-full h-2 overflow-hidden">
                        <div class="bg-[var(--brand-color)] h-2 rounded-full transition-all duration-500" style="width: ${song.percent}%"></div>
                    </div>
                </div>
            `).join('');
            document.getElementById('music-list').innerHTML = listHtml;
        } catch(e) {}
    }

    async function voteSong(id) {
        try {
            await fetch(`/api/music/vote/${id}`, {method: 'POST'});
            loadMusicData();
            if(navigator.vibrate) navigator.vibrate(50);
        } catch(e) {}
    }

    setInterval(() => {
        if(!document.getElementById('music-modal').classList.contains('hidden')) { loadMusicData(); }
    }, 3000);

    // --- Ã‡OKLU DÄ°L SÄ°STEMÄ° ---
    const translations = {
        tr: {
            welcome: "Ä°negÃ¶l'Ã¼n Lezzet DuraÄŸÄ±", settings: "Ayarlar", theme: "Tema", color: "Renk", total: "Toplam",
            confirm_cart: "Sepeti Onayla", payment_title: "Ã–deme Bilgileri", pay_btn: "Ã–deme Yap ve SipariÅŸ Ver",
            prep_title: "HazÄ±rlanÄ±yor...", prep_desc: "SipariÅŸiniz hazÄ±rlanÄ±yor, lÃ¼tfen bekleyiniz.",
            ready_title: "SÄ°PARÄ°Å HAZIR!", ready_desc: "LÃ¼tfen teslim alÄ±nÄ±z.",
            btn_received: "âœ… Teslim AldÄ±m", wait_waiter: "â³ Garson onayÄ± bekleniyor..."
        },
        en: {
            welcome: "Taste of Inegol", settings: "Settings", theme: "Theme", color: "Color", total: "Total",
            confirm_cart: "Confirm Order", payment_title: "Payment Details", pay_btn: "Pay & Order",
            prep_title: "Preparing...", prep_desc: "Your order is being prepared.",
            ready_title: "ORDER READY!", ready_desc: "Please pick up your order.",
            btn_received: "âœ… Received", wait_waiter: "â³ Waiting for Waiter..."
        }
    };
    let currentLang = 'tr';

    const categories = [
        {id:'sicak', name_tr:'SÄ±cak Ä°Ã§ecekler', name_en:'Hot Drinks'},
        {id:'soguk', name_tr:'SoÄŸuk Ä°Ã§ecekler', name_en:'Cold Drinks'},
        {id:'yemek', name_tr:'Ana Yemekler', name_en:'Main Course'},
        {id:'atistir', name_tr:'AtÄ±ÅŸtÄ±rmalÄ±k', name_en:'Snacks'},
        {id:'tatli', name_tr:'TatlÄ±lar', name_en:'Desserts'}
    ];

    // --- TAM 32 Ã‡EÅÄ°T ÃœRÃœN LÄ°STESÄ° (EKSÄ°KSÄ°Z) ---
    const menuItems = [
        {id:1, cat:'sicak', name_tr:'Ã‡ay', name_en:'Tea', price:15, img:'â˜•', desc_tr:'Taze demlenmiÅŸ Rize Ã§ayÄ±', desc_en:'Fresh brewed black tea'},
        {id:2, cat:'sicak', name_tr:'Fincan Ã‡ay', name_en:'Cup of Tea', price:25, img:'ğŸµ', desc_tr:'BÃ¼yÃ¼k fincanda', desc_en:'Large cup'},
        {id:3, cat:'sicak', name_tr:'TÃ¼rk Kahvesi', name_en:'Turkish Coffee', price:50, img:'ğŸº', desc_tr:'Ã‡ifte kavrulmuÅŸ, lokum ile', desc_en:'Traditional, with delight'},
        {id:4, cat:'sicak', name_tr:'Dibek Kahvesi', name_en:'Dibek Coffee', price:55, img:'ğŸº', desc_tr:'YumuÅŸak iÃ§im, sÃ¼tlÃ¼', desc_en:'Soft taste with milk'},
        {id:5, cat:'sicak', name_tr:'Espresso', name_en:'Espresso', price:45, img:'â˜•', desc_tr:'Tek Ã§ekim yoÄŸun kahve', desc_en:'Single shot'},
        {id:6, cat:'sicak', name_tr:'Americano', name_en:'Americano', price:55, img:'â˜•', desc_tr:'SÄ±cak su ile inceltilmiÅŸ', desc_en:'Espresso with hot water'},
        {id:7, cat:'sicak', name_tr:'Latte', name_en:'Latte', price:65, img:'ğŸ¥›', desc_tr:'Bol sÃ¼tlÃ¼ espresso', desc_en:'Espresso with steamed milk'},
        {id:8, cat:'sicak', name_tr:'Sahlep', name_en:'Salep', price:70, img:'ğŸ¥›', desc_tr:'TarÃ§Ä±nlÄ± kÄ±ÅŸ lezzeti', desc_en:'Hot orchid root drink'},
        {id:9, cat:'soguk', name_tr:'Su (33cl)', name_en:'Water', price:10, img:'ğŸ’§', desc_tr:'Cam ÅŸiÅŸe', desc_en:'Glass bottle'},
        {id:10, cat:'soguk', name_tr:'Maden Suyu', name_en:'Mineral Water', price:20, img:'ğŸ§Š', desc_tr:'DoÄŸal kaynak suyu', desc_en:'Natural mineral water'},
        {id:11, cat:'soguk', name_tr:'Cola', name_en:'Coke', price:40, img:'ğŸ¥¤', desc_tr:'Kutu 330ml', desc_en:'Canned 330ml'},
        {id:12, cat:'soguk', name_tr:'Fanta', name_en:'Fanta', price:40, img:'ğŸŠ', desc_tr:'PortakallÄ± gazoz', desc_en:'Orange soda'},
        {id:13, cat:'soguk', name_tr:'Ev YapÄ±mÄ± Limonata', name_en:'Homemade Lemonade', price:55, img:'ğŸ‹', desc_tr:'Naneli ve ferah', desc_en:'With fresh mint'},
        {id:14, cat:'soguk', name_tr:'Ayran', name_en:'Ayran', price:25, img:'ğŸ¥›', desc_tr:'KÃ¶pÃ¼klÃ¼ yayÄ±k ayranÄ±', desc_en:'Yoghurt drink'},
        {id:15, cat:'soguk', name_tr:'Ice Latte', name_en:'Ice Latte', price:70, img:'ğŸ§Š', desc_tr:'Buzlu sÃ¼tlÃ¼ kahve', desc_en:'Iced coffee with milk'},
        {id:16, cat:'soguk', name_tr:'Churchill', name_en:'Churchill', price:35, img:'ğŸ‹', desc_tr:'Soda, limon, tuz', desc_en:'Soda, lemon, salt'},
        {id:17, cat:'yemek', name_tr:'Ä°negÃ¶l KÃ¶fte', name_en:'Inegol Meatballs', price:220, img:'ğŸ¥©', desc_tr:'MeÅŸhur Ä°negÃ¶l kÃ¶ftesi, pilav ile', desc_en:'Famous local meatballs'},
        {id:18, cat:'yemek', name_tr:'KaÅŸarlÄ± KÃ¶fte', name_en:'Cheese Meatballs', price:240, img:'ğŸ§€', desc_tr:'Ä°Ã§inde erimiÅŸ kaÅŸar', desc_en:'Stuffed with cheese'},
        {id:19, cat:'yemek', name_tr:'Hamburger', name_en:'Hamburger', price:180, img:'ğŸ”', desc_tr:'150gr dana eti, patates ile', desc_en:'Beef burger with fries'},
        {id:20, cat:'yemek', name_tr:'Cheeseburger', name_en:'Cheeseburger', price:200, img:'ğŸ”', desc_tr:'Cheddar peynirli', desc_en:'With cheddar cheese'},
        {id:21, cat:'yemek', name_tr:'Tavuk Izgara', name_en:'Grilled Chicken', price:170, img:'ğŸ—', desc_tr:'BaharatlÄ± tavuk but', desc_en:'Spiced chicken leg'},
        {id:22, cat:'yemek', name_tr:'KÃ¶ri Soslu Tavuk', name_en:'Curry Chicken', price:190, img:'ğŸ›', desc_tr:'Ã–zel kÃ¶ri soslu ve makarna', desc_en:'Curry sauce with pasta'},
        {id:23, cat:'atistir', name_tr:'KaÅŸarlÄ± Tost', name_en:'Cheese Toast', price:80, img:'ğŸ¥ª', desc_tr:'Ã–zel tost ekmeÄŸine', desc_en:'Grilled cheese sandwich'},
        {id:24, cat:'atistir', name_tr:'KarÄ±ÅŸÄ±k Tost', name_en:'Mixed Toast', price:100, img:'ğŸ¥ª', desc_tr:'Sucuk ve kaÅŸarlÄ±', desc_en:'Sausage and cheese'},
        {id:25, cat:'atistir', name_tr:'Patates KÄ±zartmasÄ±', name_en:'French Fries', price:70, img:'ğŸŸ', desc_tr:'BaharatlÄ± parmak patates', desc_en:'Spicy fries'},
        {id:26, cat:'atistir', name_tr:'SoÄŸan HalkasÄ±', name_en:'Onion Rings', price:60, img:'ğŸ§…', desc_tr:'8 adet, sos ile', desc_en:'8 pcs with sauce'},
        {id:27, cat:'atistir', name_tr:'PaÃ§anga BÃ¶reÄŸi', name_en:'Pacanga Pastry', price:90, img:'ğŸ¥Ÿ', desc_tr:'PastÄ±rmalÄ± Ã§Ä±tÄ±r bÃ¶rek', desc_en:'Pastrami pastry'},
        {id:28, cat:'tatli', name_tr:'San Sebastian', name_en:'San Sebastian', price:120, img:'ğŸ°', desc_tr:'BelÃ§ika Ã§ikolatasÄ± soslu', desc_en:'With chocolate sauce'},
        {id:29, cat:'tatli', name_tr:'Magnolia', name_en:'Magnolia', price:90, img:'ğŸ“', desc_tr:'Ã‡ilekli veya Muzlu', desc_en:'Strawberry or Banana'},
        {id:30, cat:'tatli', name_tr:'Sufle', name_en:'Souffle', price:110, img:'ğŸ«', desc_tr:'SÄ±cak akÄ±ÅŸkan Ã§ikolatalÄ±', desc_en:'Hot chocolate lava cake'},
        {id:31, cat:'tatli', name_tr:'FÄ±stÄ±klÄ± Baklava', name_en:'Baklava', price:150, img:'ğŸ¯', desc_tr:'3 Dilim, Gaziantep usulÃ¼', desc_en:'Pistachio baklava'},
        {id:32, cat:'tatli', name_tr:'Dondurma (Top)', name_en:'Ice Cream', price:25, img:'ğŸ¦', desc_tr:'Sade, Kakao, Limon', desc_en:'Vanilla, Chocolate, Lemon'}
    ];

    let cart = [];
    let activeOrderId = null;

    function init() {
        requestNotificationPermission();
        
        // Kategorileri OluÅŸtur
        const navHtml = categories.map((c,i) => {
            const name = currentLang === 'tr' ? c.name_tr : c.name_en;
            return `<button onclick="scrollCat('${c.id}',this)" class="cat-btn ${i===0?'active':''} px-5 py-2 rounded-full border border-gray-300 dark:border-gray-700 font-bold whitespace-nowrap transition text-sm">${name}</button>`
        }).join('');
        document.getElementById('category-nav').innerHTML = navHtml;

        // ÃœrÃ¼nleri Listele
        const containerHtml = categories.map(cat => {
            const items = menuItems.filter(i=>i.cat===cat.id);
            if(!items.length) return '';
            const catName = currentLang === 'tr' ? cat.name_tr : cat.name_en;
            
            return `<div id="${cat.id}" class="mb-8 scroll-mt-24">
                <h3 class="font-bold text-xl mb-4 text-[var(--brand-color)] border-l-4 border-[var(--brand-color)] pl-3">${catName}</h3>
                <div class="grid gap-3">
                    ${items.map(i => {
                        const iName = currentLang === 'tr' ? i.name_tr : i.name_en;
                        const iDesc = currentLang === 'tr' ? i.desc_tr : i.desc_en;
                        return `
                        <div class="glass-card p-3 rounded-xl flex justify-between items-center shadow-sm relative overflow-hidden group cursor-pointer hover:bg-white/5 transition" onclick="openProductDetail(${i.id})">
                            <div class="flex items-center gap-3 relative z-10 pointer-events-none w-full">
                                <div class="text-3xl bg-gray-100 dark:bg-gray-800 w-14 h-14 flex items-center justify-center rounded-lg shadow-inner">${i.img}</div>
                                <div class="flex-1 min-w-0">
                                    <div class="font-bold dark:text-white truncate">${iName}</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400 truncate">${iDesc}</div>
                                    <div class="text-[var(--brand-color)] font-bold mt-1">${i.price} â‚º</div>
                                </div>
                            </div>
                            <button onclick="event.stopPropagation(); add(${i.id})" class="relative z-20 bg-gray-200 dark:bg-gray-700 w-10 h-10 rounded-full font-bold text-xl text-[var(--brand-color)] hover:bg-[var(--brand-color)] hover:text-white transition shadow-md flex-shrink-0">+</button>
                        </div>`;
                    }).join('')}
                </div>
            </div>`;
        }).join('');
        document.getElementById('menu-container').innerHTML = containerHtml;
    }

    function changeLang(lang) {
        currentLang = lang;
        document.querySelectorAll('[data-lang]').forEach(el => {
            const key = el.getAttribute('data-lang');
            if(translations[lang][key]) el.innerText = translations[lang][key];
        });
        init();
        updateCart();
    }

    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }
    function setTheme(mode) { 
        if(mode==='dark') document.documentElement.classList.add('dark'); else document.documentElement.classList.remove('dark'); 
        localStorage.setItem('theme', mode);
    }
    function setColor(color) { 
        document.documentElement.style.setProperty('--brand-color', color); 
        localStorage.setItem('brandColor', color);
    }
    if(localStorage.getItem('theme')==='dark') setTheme('dark');
    if(localStorage.getItem('brandColor')) setColor(localStorage.getItem('brandColor'));
    
    window.scrollCat=(id,b)=>{document.getElementById(id).scrollIntoView({behavior:'smooth'});document.querySelectorAll('.cat-btn').forEach(x=>x.classList.remove('active'));b.classList.add('active')};
    
    window.add=(id)=>{
        const item = menuItems.find(i=>i.id===id);
        cart.push(item);
        if(navigator.vibrate) navigator.vibrate(50);
        updateCart();
    };

    function updateCart(){
        const b=document.getElementById('cart-bar');
        if(cart.length>0){
            b.classList.remove('translate-y-[150%]');
            document.getElementById('total-price').innerText=cart.reduce((a,b)=>a+b.price,0)+' â‚º';
            document.getElementById('cart-badge').innerText=cart.length;
            document.getElementById('cart-badge').classList.remove('hidden');
        }
    }

    window.openPaymentModal=()=>document.getElementById('payment-modal').classList.remove('hidden');
    window.closePaymentModal=()=>document.getElementById('payment-modal').classList.add('hidden');

    window.processOrder = async () => {
        const name = document.getElementById('customer-name').value;
        const table = document.getElementById('table-no').value;
        if(!name) { alert(currentLang==='tr'?"Ä°sim giriniz!":"Enter name!"); return; }

        const itemsForKitchen = cart.map(i => i.name_tr).join(', ');

        try {
            const res = await fetch('/api/orders', {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    customer_name: name, 
                    table_number: table, 
                    items: itemsForKitchen, 
                    total_price: cart.reduce((a,b)=>a+b.price,0)
                })
            });
            const data = await res.json();
            if(data.status === 'success') {
                closePaymentModal();
                activeOrderId = data.order_id;
                cart = [];
                document.getElementById('cart-bar').classList.add('translate-y-[150%]');
                document.getElementById('preparing-view').classList.remove('hidden');
                startStatusCheck();
            }
        } catch(e) { alert("SipariÅŸ HatasÄ±"); }
    };

    function startStatusCheck() {
        const check = setInterval(async () => {
            if(!activeOrderId) { clearInterval(check); return; }
            try {
                const res = await fetch(`/api/orders/${activeOrderId}`);
                const order = await res.json();
                
                if(order.status === 'completed') {
                    document.getElementById('ready-view').classList.add('hidden');
                    alert(currentLang==='tr' ? "Afiyet olsun! Ä°ÅŸlem tamam." : "Enjoy! Order completed.");
                    location.reload();
                }
                else if(order.status === 'ready') {
                    document.getElementById('preparing-view').classList.add('hidden');
                    document.getElementById('ready-view').classList.remove('hidden');
                    
                    // ALARM BURADA Ã‡ALIYOR!
                    playAlarm();

                    if(order.customer_ok) {
                        document.getElementById('btn-received').classList.add('hidden');
                        document.getElementById('waiting-waiter-msg').classList.remove('hidden');
                    }
                }
            } catch(e) {}
        }, 3000);
    }

    window.confirmReceived = async () => {
        if(!activeOrderId) return;
        try {
            await fetch(`/api/orders/${activeOrderId}/confirm`, {
                method: 'PUT', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({role: 'customer'})
            });
            document.getElementById('btn-received').classList.add('hidden');
            document.getElementById('waiting-waiter-msg').classList.remove('hidden');
        } catch(e) { alert("Hata"); }
    };

    init();
  </script>
</body>
</html>
